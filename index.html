<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Void Echoes</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --gold: #ffd700;
            --blue: #00d4ff;
            --bg-panel: rgba(10, 10, 15, 0.95);
            --bg-modal: rgba(5, 5, 10, 0.98);
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            background-color: #000;
            font-family: sans-serif;
            color: white;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        /* ЭКРАНЫ */
        .screen {
            display: none; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            position: absolute; top: 0; left: 0;
            opacity: 0; transition: opacity 0.5s ease;
        }

        /* ЗАГРУЗКА */
        #loading-screen {
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 9999; background: #050505;
            opacity: 1;
        }
        .loader-bar {
            width: 200px; height: 10px; background: #333;
            border: 1px solid var(--blue); border-radius: 5px;
            margin-top: 20px; overflow: hidden;
        }
        .loader-fill {
            width: 0%; height: 100%; background: var(--blue);
            transition: width 0.3s;
        }

        /* ВЫБОР ГЕРОЯ */
        .selection-ui {
            position: absolute; bottom: 0; width: 100%;
            padding-bottom: env(safe-area-inset-bottom);
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            display: flex; flex-direction: column; align-items: center;
        }
        .hero-preview {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            pointer-events: none;
        }
        .hero-preview img {
            width: 100%; height: 100%; object-fit: contain;
            transform: scale(1.1) translateY(5%);
        }
        
        .class-icons { display: flex; gap: 20px; margin-bottom: 20px; pointer-events: auto; }
        .c-icon { 
            width: 50px; height: 50px; border-radius: 50%; 
            border: 2px solid #555; overflow: hidden; transition: 0.3s;
            background: #000;
        }
        .c-icon.active { border-color: var(--gold); transform: scale(1.15); }
        .c-icon img { width: 100%; height: 100%; }

        .gender-select {
            display: flex; gap: 10px; margin-bottom: 15px; pointer-events: auto;
        }
        .g-btn {
            width: 40px; height: 40px; border: 1px solid var(--gold);
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; background: rgba(0,0,0,0.5);
            font-weight: bold; color: var(--gold);
        }
        .g-btn.active { background: var(--gold); color: #000; }

        .btn-confirm {
            background: var(--gold); color: #000; border: none;
            padding: 12px 40px; font-size: 18px; font-weight: bold;
            border-radius: 8px; margin-bottom: 30px; pointer-events: auto;
            text-transform: uppercase;
        }

        /* ИНТЕРФЕЙС МЕНЮ */
        .top-bar {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 10px; box-sizing: border-box;
            display: flex; justify-content: space-between;
            z-index: 100;
        }
        .res-panel {
            display: flex; flex-direction: column; gap: 5px; align-items: flex-end;
        }
        .res-item {
            background: rgba(0,0,0,0.6); border: 1px solid #444;
            padding: 4px 10px; border-radius: 15px;
            display: flex; align-items: center; gap: 5px;
        }

        .avatar-box {
            display: flex; align-items: center; gap: 10px;
            background: rgba(0,0,0,0.6); padding: 5px 15px 5px 5px;
            border-radius: 12px; border: 1px solid #444;
        }
        .avatar-box img { width: 45px; height: 45px; border-radius: 8px; border: 1px solid var(--gold); }
        
        /* ИКОНКИ НИЖНЕГО МЕНЮ */
        .ui-layer { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; z-index: 500; display: none; 
        }
        .menu-icon { 
            position: absolute; width: 60px; height: 60px; 
            pointer-events: auto; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        .menu-icon img { width: 100%; height: 100%; object-fit: contain; }
        .menu-icon:active { transform: scale(0.9); }

        .nav-arrow {
            position: absolute; width: 50px; height: 50px;
            background: rgba(0,0,0,0.8); border: 2px solid var(--gold);
            border-radius: 50%; pointer-events: auto; z-index: 600;
            display: flex; align-items: center; justify-content: center;
        }
        .nav-arrow::after {
            content: ''; border: solid var(--gold);
            border-width: 0 4px 4px 0; display: inline-block;
            padding: 5px; transform: rotate(-45deg);
        }
        .nav-arrow.flip::after { transform: rotate(135deg); margin-top: 5px; }

        /* ИНВЕНТАРЬ */
        #inventory-screen { z-index: 800; background: #111; }
        .inv-layout {
            width: 100%; height: 100%; position: relative;
        }
        .close-btn {
            position: absolute; top: 20px; left: 20px;
            font-size: 30px; color: #fff; z-index: 801;
        }
        .hero-stand {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            height: 60%; z-index: 0;
        }
        .slots-left, .slots-right {
            position: absolute; top: 20%; bottom: 20%;
            display: flex; flex-direction: column; justify-content: space-evenly;
            width: 70px; z-index: 10;
        }
        .slots-left { left: 10px; }
        .slots-right { right: 10px; }
        .slot {
            width: 60px; height: 60px; background: rgba(255,255,255,0.1);
            border: 1px solid #555; display: flex; align-items: center; justify-content: center;
        }
        .slot img { width: 90%; height: 90%; object-fit: contain; }

        /* SKILL MODAL */
        #modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000;
            align-items: center; justify-content: center;
        }
        .modal-box {
            background: #1a1a1a; border: 2px solid var(--gold);
            padding: 20px; border-radius: 10px; width: 80%; max-width: 300px;
            text-align: center;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="loading-screen" class="screen" style="display: flex;">
        <h2 style="color: var(--blue);">VOID ECHOES</h2>
        <div class="loader-bar"><div id="loader-fill" class="loader-fill"></div></div>
        <p id="load-text" style="margin-top: 10px; color: #777;">Загрузка...</p>
    </div>

    <div id="selection-screen" class="screen">
        <div class="hero-preview">
            <img id="sel-hero-img" src="">
        </div>
        <div class="selection-ui">
            <h2 id="class-name" style="color:var(--gold); margin-bottom:10px; text-transform:uppercase;"></h2>
            
            <div class="gender-select">
                <div id="g-male" class="g-btn active" onclick="setGender('male')">M</div>
                <div id="g-female" class="g-btn" onclick="setGender('female')">Ж</div>
            </div>

            <div class="class-icons">
                <div class="c-icon" id="icon-warrior" onclick="selectClass('warrior')">
                    <img src="icon_hero_paladin.png">
                </div>
                <div class="c-icon" id="icon-mage" onclick="selectClass('mage')">
                    <img src="icon_hero_mage.png">
                </div>
                <div class="c-icon" id="icon-archer" onclick="selectClass('archer')">
                    <img src="icon_hero_ranger.png">
                </div>
            </div>

            <button class="btn-confirm" onclick="confirmHero()">В БОЙ</button>
        </div>
    </div>

    <div id="menu-screen" class="screen">
        <div class="top-bar">
            <div class="avatar-box" onclick="openInventory()">
                <img id="menu-ava" src="">
                <div>
                    <div id="menu-name" style="font-weight:bold; color:var(--gold);">Игрок</div>
                    <div style="font-size:12px; color:#ccc;">Уровень 1</div>
                </div>
            </div>
            <div class="res-panel">
                <div class="res-item"><img src="icon_gold.png" width="20"> <span id="val-gold">0</span></div>
                <div class="res-item"><img src="icon_crystal.png" width="20"> <span id="val-crys">0</span></div>
            </div>
        </div>
    </div>

    <div id="inventory-screen" class="screen">
        <div class="close-btn" onclick="closeInventory()">×</div>
        <div class="inv-layout">
            <img id="inv-hero" class="hero-stand" src="">
            <div class="slots-left">
                <div class="slot"><img src="helmet.png"></div>
                <div class="slot"><img src="chestplate.png"></div>
                <div class="slot"><img src="hammer.png"></div>
            </div>
            <div class="slots-right">
                <div class="slot"><img src="bracers.png"></div>
                <div class="slot"><img src="boots.png"></div>
                <div class="slot"><img src="ring.png"></div>
            </div>
        </div>
    </div>

    <div id="ui-layer" class="ui-layer">
        </div>

    <script>
        // --- ДАННЫЕ (ПОЛНЫЕ) ---
        const HEROES = {
            warrior: {
                name: "Воин", bg: "UI_Background_Warrior.png",
                m: "hero_warrior_male.png", f: "hero_warrior_female.png",
                ava_m: "ava_warrior_male.png", ava_f: "ava_warrior_female.png",
                skills: [
                   {n:"Удар", d:"Базовая атака"}, {n:"Вихрь", d:"Урон по площади"}, 
                   {n:"Рывок", d:"Оглушение"}, {n:"Щит", d:"Защита +30%"}, {n:"Ярость", d:"Ульта"}
                ]
            },
            mage: {
                name: "Маг", bg: "UI_Background_Mage.png",
                m: "hero_mage_male.png", f: "hero_mage_female.png",
                ava_m: "ava_mage_male.png", ava_f: "ava_mage_female.png",
                skills: [
                   {n:"Шар", d:"Огонь"}, {n:"Лед", d:"Замедление"}, 
                   {n:"Гроза", d:"Стан"}, {n:"Барьер", d:"Щит маны"}, {n:"Пустота", d:"Ульта"}
                ]
            },
            archer: {
                name: "Лучник", bg: "UI_Background_Archer.png",
                m: "hero_archer_male.png", f: "hero_archer_female.png",
                ava_m: "ava_archer_male.png", ava_f: "ava_archer_female.png",
                skills: [
                   {n:"Выстрел", d:"Крит"}, {n:"Град", d:"Мультишот"}, 
                   {n:"Капкан", d:"Руты"}, {n:"Уворот", d:"Додж"}, {n:"Орел", d:"Ульта"}
                ]
            }
        };

        // НАСТРОЙКИ КООРДИНАТ
        const isTablet = window.innerWidth > 600;
        const LAYOUT = isTablet ? {
            panel: { x: -17, y: 880, w: 854, h: 130 },
            icons: {
                quests: { x: -19, y: 877, s: 145 }, battle: { x: 102, y: 880, s: 160 },
                alliance: { x: 237, y: 882, s: 150 }, inventory: { x: 487, y: 872, s: 150 },
                benchmark: { x: 477, y: 868, s: 162 }, rating: { x: 229, y: 871, s: 162 },
                profile: { x: 99, y: 867, s: 165 }, lotto: { x: 344, y: 870, s: 167 }
            }
        } : {
            panel: { x: -24, y: 551, w: 398, h: 99 },
            icons: {
                quests: { x: -22, y: 551, s: 106 }, battle: { x: 59, y: 553, s: 119 },
                alliance: { x: 154, y: 554, s: 110 }, inventory: { x: 248, y: 547, s: 112 },
                benchmark: { x: 238, y: 542, s: 127 }, rating: { x: 57, y: 544, s: 127 },
                profile: { x: -27, y: 543, s: 123 }, lotto: { x: 143, y: 543, s: 131 }
            }
        };

        const PAGE_1 = ["quests", "battle", "alliance", "inventory"];
        const PAGE_2 = ["benchmark", "rating", "profile", "lotto"];

        // СОСТОЯНИЕ
        let curClass = 'warrior';
        let curGender = 'male';
        let curPage = 1;
        let userId = 12345;
        const tg = window.Telegram?.WebApp;
        if(tg) { tg.expand(); userId = tg.initDataUnsafe?.user?.id || 12345; }

        // --- ЗАПУСК ---
        window.onload = function() {
            startFakeLoading();
        };

        function startFakeLoading() {
            let pct = 0;
            const bar = document.getElementById('loader-fill');
            const txt = document.getElementById('load-text');
            
            // Быстрая фейк-загрузка чтобы UI появился 100%
            const int = setInterval(() => {
                pct += 5;
                bar.style.width = pct + "%";
                if(pct >= 100) {
                    clearInterval(int);
                    txt.innerText = "Готово!";
                    checkServerData();
                }
            }, 50);
        }

        async function checkServerData() {
            // Попытка получить данные, но с защитой от ошибок
            try {
                // Пытаемся стукнуться на сервер, но не блокируем если он лежит
                // const res = await fetch(...) - ЗАКОММЕНТИРОВАЛ ЧТОБЫ НЕ ЛОМАЛОСЬ
                // Если сервера нет, просто показываем выбор героя
                showSelection();
            } catch(e) {
                console.log("Offline mode");
                showSelection();
            }
        }

        // --- ЛОГИКА ЭКРАНОВ ---
        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => {
                s.style.opacity = 0;
                setTimeout(() => s.style.display = 'none', 500);
            });
            const el = document.getElementById(id);
            el.style.display = (id === 'loading-screen' || id === 'inventory-screen') ? 'flex' : 'block';
            setTimeout(() => el.style.opacity = 1, 50);

            // UI Layer показываем только в меню
            const ui = document.getElementById('ui-layer');
            ui.style.display = (id === 'menu-screen') ? 'block' : 'none';
        }

        function showSelection() {
            switchScreen('selection-screen');
            selectClass('warrior');
        }

        function selectClass(cls) {
            curClass = cls;
            // Обновляем иконки
            ['warrior','mage','archer'].forEach(c => {
                document.getElementById('icon-'+c).classList.toggle('active', c===cls);
            });
            
            const data = HEROES[cls];
            document.getElementById('class-name').innerText = data.name;
            document.getElementById('selection-screen').style.backgroundImage = `url('${data.bg}')`;
            updateHeroImages();
        }

        function setGender(g) {
            curGender = g;
            document.getElementById('g-male').classList.toggle('active', g==='male');
            document.getElementById('g-female').classList.toggle('active', g==='female');
            updateHeroImages();
        }

        function updateHeroImages() {
            const data = HEROES[curClass];
            const imgKey = (curGender === 'male') ? 'm' : 'f';
            const src = data[imgKey];
            document.getElementById('sel-hero-img').src = src;
            document.getElementById('inv-hero').src = src; // для инвентаря сразу
            document.getElementById('menu-ava').src = data[(curGender==='male'?'ava_m':'ava_f')];
        }

        function confirmHero() {
            // Тут можно отправить данные на сервер
            // fetch(...)
            showMenu();
        }

        function showMenu() {
            document.getElementById('menu-screen').style.backgroundImage = `url('bg_menu_main.png')`;
            initIcons();
            switchScreen('menu-screen');
        }

        // --- ГЕНЕРАЦИЯ ИКОНОК ---
        function initIcons() {
            const container = document.getElementById('ui-layer');
            container.innerHTML = ''; // очистка

            // Панель подложка
            const panel = document.createElement('div');
            panel.style.position = 'absolute';
            panel.style.left = LAYOUT.panel.x + 'px';
            panel.style.top = LAYOUT.panel.y + 'px';
            panel.style.width = LAYOUT.panel.w + 'px';
            panel.style.height = LAYOUT.panel.h + 'px';
            panel.style.background = 'rgba(85, 45, 25, 0.6)';
            panel.style.borderTop = '2px solid #ffd700';
            panel.style.pointerEvents = 'none';
            container.appendChild(panel);

            // Стрелка
            const arrow = document.createElement('div');
            arrow.className = 'nav-arrow';
            // Центрируем стрелку относительно панели (грубо)
            arrow.style.left = (LAYOUT.panel.x + LAYOUT.panel.w/2 - 25) + 'px';
            arrow.style.top = (LAYOUT.panel.y - 30) + 'px';
            arrow.onclick = togglePage;
            container.appendChild(arrow);
            window.arrowEl = arrow;

            // Иконки
            for(let key in LAYOUT.icons) {
                const cfg = LAYOUT.icons[key];
                const icon = document.createElement('div');
                icon.className = 'menu-icon';
                icon.id = 'btn-'+key;
                icon.style.left = cfg.x + 'px';
                icon.style.top = cfg.y + 'px';
                icon.style.width = cfg.s + 'px';
                icon.style.height = cfg.s + 'px';
                
                const img = document.createElement('img');
                img.src = `icon_${key}.png`;
                img.onerror = function() { this.src = 'https://via.placeholder.com/100?text='+key; }; // Заглушка если нет картинки
                
                icon.appendChild(img);
                icon.onclick = () => handleIconClick(key);
                container.appendChild(icon);
            }
            updateIconVis();
        }

        function togglePage() {
            curPage = (curPage === 1) ? 2 : 1;
            window.arrowEl.classList.toggle('flip', curPage === 2);
            updateIconVis();
        }

        function updateIconVis() {
            const all = [...PAGE_1, ...PAGE_2];
            all.forEach(key => {
                const el = document.getElementById('btn-'+key);
                if(!el) return;
                const visible = (curPage === 1 && PAGE_1.includes(key)) || (curPage === 2 && PAGE_2.includes(key));
                el.classList.toggle('hidden', !visible);
            });
        }

        function handleIconClick(key) {
            if(key === 'inventory') openInventory();
            else alert("Раздел " + key + " в разработке!");
        }

        // --- ИНВЕНТАРЬ ---
        function openInventory() {
            document.getElementById('inventory-screen').style.display = 'block';
            setTimeout(()=> document.getElementById('inventory-screen').style.opacity = 1, 10);
        }
        function closeInventory() {
            document.getElementById('inventory-screen').style.opacity = 0;
            setTimeout(()=> document.getElementById('inventory-screen').style.display = 'none', 500);
        }

    </script>
</body>
</html>
