<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Void Echoes</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --gold: #ffd700;
            --blue: #00d4ff;
            --bg-panel: rgba(10, 10, 15, 0.9);
            --bg-modal: rgba(5, 5, 10, 0.95);
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            background-color: #000;
            font-family: 'Segoe UI', sans-serif;
            color: white;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        /* --- ЗАГРУЗОЧНЫЙ ЭКРАН --- */
        #loading-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: url('bg_loading_main_v1.png') no-repeat center center/cover;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 100; transition: opacity 0.8s ease;
        }

        .logo-main {
            width: 250px;
            margin-bottom: 30px;
            filter: drop-shadow(0 0 15px rgba(0, 212, 255, 0.5));
        }

        .loader-container { 
            width: 80%; max-width: 450px; 
            position: relative;
        }

        .progress-bar { 
            height: 30px; 
            background: rgba(0, 0, 0, 0.7); 
            border: 2px solid rgba(0, 212, 255, 0.4);
            border-radius: 15px; 
            overflow: hidden; 
            position: relative;
        }

        .progress-fill { 
            width: 0%; height: 100%; 
            background: linear-gradient(90deg, #005f73, var(--blue), #005f73);
            background-size: 200% 100%;
            box-shadow: 0 0 15px var(--blue); 
            transition: width 0.3s ease;
            position: relative;
            animation: shine 2s linear infinite;
        }

        @keyframes shine {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .progress-text {
            position: absolute; width: 100%;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-weight: bold; font-size: 16px;
            color: white; text-shadow: 1px 1px 2px black;
            z-index: 2;
        }

        /* --- ЭКРАН ВЫБОРА ГЕРОЯ --- */
        #selection-screen {
            display: none; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            opacity: 0; transition: opacity 0.6s ease;
            position: relative;
        }

        .selection-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            width: 100%; height: 100%;
            padding: 2vh 0;
            box-sizing: border-box;
            z-index: 2;
        }

        .hero-view {
            width: 100%;
            flex: 0 0 42vh;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            margin-bottom: 10px;
        }

        .hero-view img {
            max-height: 100%;
            max-width: 90%;
            object-fit: contain;
            filter: drop-shadow(0 0 30px rgba(0,0,0,1));
        }

        .skills-card {
            width: 90%;
            max-width: 400px;
            background: var(--bg-panel);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 12px;
            padding: 12px 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .skills-card h2 {
            margin: 0 0 10px 0;
            text-align: center;
            color: var(--gold);
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .skill-item {
            display: flex; align-items: center;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.03);
            padding: 6px; border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .skill-item:active {
            background: rgba(0, 212, 255, 0.1);
        }

        .skill-img {
            width: 35px; height: 35px;
            border: 1px solid var(--gold);
            border-radius: 4px; margin-right: 12px;
        }

        .skill-content { flex-grow: 1; }
        .skill-meta {
            display: flex; justify-content: space-between;
            font-size: 0.75rem; margin-bottom: 4px;
            font-weight: bold; color: #ddd;
        }

        .bar-bg { width: 100%; height: 4px; background: #222; border-radius: 2px; }
        .bar-fill { height: 100%; background: var(--blue); border-radius: 2px; transition: width 1s ease-out; }

        .class-selector {
            width: 100%;
            margin-top: auto; 
            padding-bottom: 25px;
            display: flex; justify-content: center; align-items: center;
            gap: 25px;
        }

        .icon-btn {
            display: flex; flex-direction: column; align-items: center;
            cursor: pointer; transition: 0.3s;
            filter: grayscale(1) brightness(0.5);
        }

        .icon-btn img {
            width: 55px; height: 55px;
            border-radius: 50%;
            border: 2px solid transparent;
            margin-bottom: 4px;
        }

        .icon-btn.active {
            filter: grayscale(0) brightness(1.2);
            transform: scale(1.1);
        }

        .icon-btn.active img {
            border-color: var(--gold);
            box-shadow: 0 0 15px var(--gold);
        }

        .icon-btn span { font-size: 0.7rem; color: var(--gold); font-weight: bold; }

        /* --- МОДАЛЬНОЕ ОКНО ОПИСАНИЯ --- */
        #skill-modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 200;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            width: 80%;
            max-width: 320px;
            background: var(--bg-modal);
            border: 2px solid var(--gold);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            animation: modalIn 0.3s ease-out;
        }

        @keyframes modalIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-icon {
            width: 80px; height: 80px;
            border: 2px solid var(--gold);
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .modal-title {
            color: var(--gold);
            font-size: 1.4rem;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .modal-desc {
            font-size: 0.95rem;
            line-height: 1.4;
            color: #ccc;
            margin-bottom: 20px;
        }

        .close-btn {
            background: var(--gold);
            color: black;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
        }

        @media (min-aspect-ratio: 1/1) {
            .selection-container { flex-direction: row; justify-content: center; gap: 40px; }
            .hero-view { flex: 0 0 40%; height: 75vh; }
            .skills-card { width: 350px; }
            .class-selector { position: absolute; bottom: 10px; }
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <img src="icon_logo_void_echoes.png" class="logo-main" alt="Logo">
        <div class="loader-container">
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
                <div id="progress-text" class="progress-text">0%</div>
            </div>
        </div>
    </div>

    <div id="selection-screen">
        <div class="selection-container">
            <div class="hero-view">
                <img id="hero-img" src="" alt="Hero">
            </div>

            <div class="skills-card">
                <h2 id="class-title">КЛАСС</h2>
                <div id="skills-list"></div>
            </div>

            <div class="class-selector">
                <div class="icon-btn" id="btn-warrior" onclick="selectHero('warrior')">
                    <img src="icon_hero_paladin.png" alt="Воин">
                    <span>Воин</span>
                </div>
                <div class="icon-btn" id="btn-mage" onclick="selectHero('mage')">
                    <img src="icon_hero_mage.png" alt="Маг">
                    <span>Маг</span>
                </div>
                <div class="icon-btn" id="btn-archer" onclick="selectHero('archer')">
                    <img src="icon_hero_ranger.png" alt="Лучник">
                    <span>Лучник</span>
                </div>
            </div>
        </div>
    </div>

    <div id="skill-modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <img id="modal-img" src="" class="modal-icon">
            <div id="modal-name" class="modal-title">Название</div>
            <div id="modal-text" class="modal-desc">Описание навыка...</div>
            <button class="close-btn" onclick="closeModal()">Закрыть</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;

        if (tg) {
            tg.expand();
            tg.setHeaderColor('#000000');
            tg.setBackgroundColor('#000000');
            if (tg.disableVerticalSwipes) tg.disableVerticalSwipes();
            tg.ready();
        }

        const heroesData = {
            warrior: {
                title: "ВОИН", bg: "UI_Background_Warrior.png", image: "hero_warrior_male.png",
                skills: [
                    { n: "Базовый урон", i: "war_1_basic.png", p: 75, d: "Мощный удар мечом, наносящий физический урон ближайшей цели." },
                    { n: "Массовый урон", i: "war_2_aoe.png", p: 65, d: "Круговой удар щитом, поражающий всех врагов в небольшом радиусе." },
                    { n: "Контроль", i: "war_3_control.png", p: 40, d: "Оглушающий рывок, который прерывает заклинания противника." },
                    { n: "Живучесть", i: "war_4_survivability.png", p: 95, d: "Пассивная броня и увеличенный запас здоровья для долгого боя." },
                    { n: "Ультимейт", i: "war_5_ultimate.png", p: 80, d: "Гнев титана: увеличивает урон и защиту на 15 секунд." }
                ]
            },
            mage: {
                title: "МАГ", bg: "UI_Background_Mage.png", image: "hero_mage_male.png",
                skills: [
                    { n: "Базовый урон", i: "mag_1_basic.png", p: 85, d: "Сгусток чистой энергии, летящий в цель на большой дистанции." },
                    { n: "Массовый урон", i: "mag_2_aoe.png", p: 95, d: "Метеоритный дождь, выжигающий область на поле боя." },
                    { n: "Контроль", i: "mag_3_control.png", p: 70, d: "Ледяное кольцо, замораживающее ноги противников." },
                    { n: "Живучесть", i: "mag_4_survivability.png", p: 30, d: "Магический щит, поглощающий часть урона за счет маны." },
                    { n: "Ультимейт", i: "mag_5_ultimate.png", p: 90, d: "Разлом пустоты: мгновенно уничтожает слабых врагов в радиусе." }
                ]
            },
            archer: {
                title: "ЛУЧНИК", bg: "UI_Background_Archer.png", image: "hero_archer_male.png",
                skills: [
                    { n: "Базовый урон", i: "arc_1_basic_attack.png", p: 90, d: "Точный выстрел в уязвимое место с высоким шансом крита." },
                    { n: "Массовый урон", i: "arc_2_aoe_damage.png", p: 70, d: "Залп стрел, покрывающий конусообразную область перед собой." },
                    { n: "Контроль", i: "arc_3_control.png", p: 60, d: "Замедляющая ловушка, сковывающая движения наступающих." },
                    { n: "Живучесть", i: "arc_4_survivability.png", p: 50, d: "Уворот и высокая скорость перемещения позволяют избегать атак." },
                    { n: "Ультимейт", i: "arc_5_ultimate.png", p: 85, d: "Око орла: каждая стрела становится самонаводящейся и взрывной." }
                ]
            }
        };

        const assetsToLoad = [
            'bg_loading_main_v1.png', 'icon_logo_void_echoes.png',
            'UI_Background_Warrior.png', 'UI_Background_Mage.png', 'UI_Background_Archer.png',
            'hero_warrior_male.png', 'hero_mage_male.png', 'hero_archer_male.png',
            'icon_hero_paladin.png', 'icon_hero_mage.png', 'icon_hero_ranger.png',
            'war_1_basic.png', 'war_2_aoe.png', 'war_3_control.png', 'war_4_survivability.png', 'war_5_ultimate.png',
            'mag_1_basic.png', 'mag_2_aoe.png', 'mag_3_control.png', 'mag_4_survivability.png', 'mag_5_ultimate.png',
            'arc_1_basic_attack.png', 'arc_2_aoe_damage.png', 'arc_3_control.png', 'arc_4_survivability.png', 'arc_5_ultimate.png'
        ];

        let loadedCount = 0;
        let currentHeroKey = 'warrior';

        function updateProgress() {
            const percent = Math.floor((loadedCount / assetsToLoad.length) * 100);
            const fill = document.getElementById('progress-fill');
            const text = document.getElementById('progress-text');
            if(fill) fill.style.width = percent + '%';
            if(text) text.innerText = percent + '%';
            if (loadedCount >= assetsToLoad.length) { setTimeout(initGame, 1000); }
        }

        function preloadAssets() {
            if (assetsToLoad.length === 0) { initGame(); return; }
            assetsToLoad.forEach(src => {
                const img = new Image();
                img.onload = () => { loadedCount++; updateProgress(); };
                img.onerror = () => { loadedCount++; updateProgress(); };
                img.src = src;
            });
        }

        function initGame() {
            const ls = document.getElementById('loading-screen');
            if (ls) {
                ls.style.opacity = '0';
                setTimeout(() => {
                    ls.style.display = 'none';
                    const s = document.getElementById('selection-screen');
                    if(s) {
                        s.style.display = 'block';
                        setTimeout(() => { s.style.opacity = '1'; selectHero('warrior'); }, 50);
                    }
                }, 800);
            }
        }

        function selectHero(key) {
            currentHeroKey = key;
            const d = heroesData[key];
            const screen = document.getElementById('selection-screen');
            const heroImg = document.getElementById('hero-img');
            const title = document.getElementById('class-title');
            const list = document.getElementById('skills-list');

            if(screen) screen.style.backgroundImage = `url('${d.bg}')`;
            if(heroImg) heroImg.src = d.image;
            if(title) title.innerText = d.title;
            
            if(list) {
                list.innerHTML = '';
                d.skills.forEach((sk, index) => {
                    list.innerHTML += `
                        <div class="skill-item" onclick="openSkill(${index})">
                            <img src="${sk.i}" class="skill-img">
                            <div class="skill-content">
                                <div class="skill-meta"><span>${sk.n}</span><span>${sk.p}%</span></div>
                                <div class="bar-bg"><div class="bar-fill" style="width:${sk.p}%"></div></div>
                            </div>
                        </div>`;
                });
            }
            document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('active'));
            const activeBtn = document.getElementById(`btn-${key}`);
            if(activeBtn) activeBtn.classList.add('active');
        }

        // Логика Модалки
        function openSkill(index) {
            const skill = heroesData[currentHeroKey].skills[index];
            document.getElementById('modal-img').src = skill.i;
            document.getElementById('modal-name').innerText = skill.n;
            document.getElementById('modal-text').innerText = skill.d;
            document.getElementById('skill-modal').style.display = 'flex';
            
            // Легкая вибрация при открытии (только в Telegram)
            if (tg && tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        }

        function closeModal() {
            document.getElementById('skill-modal').style.display = 'none';
        }

        window.onload = preloadAssets;
    </script>
</body>
</html>
