<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo of Void - Arena</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #0f0f1a;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            user-select: none;
        }
        .card {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border-radius: 20px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.7);
            border: 1px solid #4ecca3;
            text-align: center;
            margin-top: 20px;
        }
        h1 {
            color: #4ecca3;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            font-size: 1.1em;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
        }
        .stat-label {
            color: #bbb;
        }
        .stat-value {
            color: #4ecca3;
            font-weight: bold;
        }
        button {
            background: linear-gradient(90deg, #4ecca3, #45b293);
            color: #1a1a2e;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1em;
            cursor: pointer;
            margin-top: 25px;
            width: 100%;
            box-shadow: 0 4px 15px rgba(78, 204, 163, 0.3);
            transition: all 0.2s ease;
        }
        button:active {
            transform: scale(0.96);
            box-shadow: 0 2px 10px rgba(78, 204, 163, 0.2);
        }
        #status-bar {
            margin-top: 20px;
            font-size: 0.8em;
            padding: 8px 15px;
            border-radius: 20px;
            background: rgba(0,0,0,0.3);
            color: #888;
        }
        .loading {
            color: #fca311;
        }
        .online {
            color: #4ecca3;
        }
        .error {
            color: #e63946;
        }
    </style>
</head>
<body>

    <div class="card">
        <h1 id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
        
        <div class="stat-row">
            <span class="stat-label">–£—Ä–æ–≤–µ–Ω—å</span>
            <span id="level" class="stat-value">--</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</span>
            <span id="hp" class="stat-value">-- / --</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">‚öîÔ∏è –ê—Ç–∞–∫–∞</span>
            <span id="attack" class="stat-value">--</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">üõ°Ô∏è –ó–∞—â–∏—Ç–∞</span>
            <span id="defense" class="stat-value">--</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">üí∞ –ó–æ–ª–æ—Ç–æ</span>
            <span id="gold" class="stat-value">--</span>
        </div>

        <button onclick="trainStat('attack')">üèãÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å –ê—Ç–∞–∫—É (10üí∞)</button>
        <button onclick="trainStat('defense')" style="margin-top: 10px; background: #2d4263; color: white;">üõ°Ô∏è –£—Å–∏–ª–∏—Ç—å –ó–∞—â–∏—Ç—É (10üí∞)</button>
    </div>

    <div id="status-bar">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        tg.ready();

        // –¢–í–û–ô –ê–ö–¢–£–ê–õ–¨–ù–´–ô URL –°–ï–†–í–ï–†–ê –ò–ó CLOUDFLARE
        const SERVER_URL = "https://diabetes-electro-chairs-core.trycloudflare.com"; 
        
        // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram –∏–ª–∏ —Å—Ç–∞–≤–∏–º —Ç–µ—Å—Ç–æ–≤—ã–π –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
        const user = tg.initDataUnsafe.user;
        const userId = user ? user.id : 123456789;
        const userName = user ? (user.username || user.first_name) : "–ù–µ–∑–Ω–∞–∫–æ–º–µ—Ü";

        const statusEl = document.getElementById('status-bar');

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI(data) {
            document.getElementById('username').innerText = data.username || userName;
            document.getElementById('level').innerText = data.level;
            document.getElementById('hp').innerText = `${data.hp} / ${data.max_hp}`;
            document.getElementById('attack').innerText = data.attack;
            document.getElementById('defense').innerText = data.defense;
            document.getElementById('gold').innerText = data.gold;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–µ—Ä–æ—è —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadHero() {
            statusEl.innerText = "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...";
            statusEl.className = "loading";
            try {
                const response = await fetch(`${SERVER_URL}/get_hero/${userId}`);
                if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏");
                const data = await response.json();
                updateUI(data);
                statusEl.innerText = "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
                statusEl.className = "online";
            } catch (err) {
                console.error(err);
                statusEl.innerText = "–û—à–∏–±–∫–∞: –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω";
                statusEl.className = "error";
            }
        }

        // –ü—Ä–æ–∫–∞—á–∫–∞ —Å—Ç–∞—Ç–æ–≤
        async function trainStat(statType) {
            statusEl.innerText = "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏...";
            try {
                const response = await fetch(`${SERVER_URL}/train/${userId}/${statType}`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.status === "success") {
                    tg.HapticFeedback.impactOccurred('medium'); // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫
                    loadHero(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                } else {
                    alert(data.message || "–û—à–∏–±–∫–∞");
                    loadHero();
                }
            } catch (err) {
                alert("–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
            }
        }

        // –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        loadHero();
    </script>
</body>
</html>
